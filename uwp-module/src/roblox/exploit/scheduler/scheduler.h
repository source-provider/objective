#pragma once
#include <Windows.h>
#include <cstdint>
#include <vector>
#include <string_view>

#include <roblox/miscellaneous/offsets/addresses.h>
#include <roblox/security/obfuscation/string.h>

struct lua_State;
namespace module {
	class vfhook;
	class scheduler {
	private:
		static scheduler* singleton;
		std::intptr_t taskScheduler{ 0 };
		vfhook* schedulerHook{ nullptr };
		std::vector<std::intptr_t> jobVector{};
	public:
		using jobType = std::intptr_t(__thiscall*)(std::intptr_t, std::intptr_t);
	public:
		static auto getSingleton() -> scheduler*;
		explicit scheduler();
		auto reInitialize() -> void; /* used in teleport handler */

		auto getJobName(std::intptr_t job) -> std::string;
		auto getJob(std::string_view name) -> std::intptr_t;
		auto jobHook(void* hookFunc) -> std::intptr_t;

		auto setFps(double fps) -> void;
		auto getFps() -> double;

		auto getScriptJob() -> std::intptr_t;
		auto getScriptContext(std::intptr_t scriptJob = -1) -> std::intptr_t;
		auto getDataModel(std::intptr_t scriptJob = -1) -> std::intptr_t;
		auto getLuaState(std::intptr_t context = -1) -> lua_State*;

		auto getRawDataModel() -> std::intptr_t;
		auto isLoaded() -> bool;
	};
}